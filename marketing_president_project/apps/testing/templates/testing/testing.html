{% extends "base.html" %}

{% block title %}Testing Tabs{% endblock %}

{% block content %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

<div class="container py-4">
    <h1 class="mb-4">Halaman Testing Tabs</h1>

    <ul class="nav nav-tabs mb-4" id="testingTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="form-tab" data-bs-toggle="tab" data-bs-target="#form" type="button" role="tab">
                Form
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="upload-tab" data-bs-toggle="tab" data-bs-target="#upload" type="button" role="tab">
                Upload
            </button>
        </li>
    </ul>

    <div class="tab-content" id="testingTabsContent">
        <!-- Form Tab -->
        <div class="tab-pane fade show active" id="form" role="tabpanel" aria-labelledby="form-tab">
            <div class="card p-4">
                <h5>Form Input Data</h5>
                   <form method="POST" action="{% url 'testing:form_predict' %}">
                    {% csrf_token %}
                    
                    <div class="row">
                        <!-- DOB -->
                        <div class="col-md-6 mb-3">
                            <label for="dob" class="form-label">Tanggal Lahir</label>
                            <input type="date" class="form-control" id="dob" name="dob">
                        </div>

                        <!-- Gender -->
                        <div class="col-md-6 mb-3">
                            <label for="gender" class="form-label">Jenis Kelamin</label>
                            <select class="form-control" id="gender" name="gender">
                                <option value="">Pilih</option>
                                <option value="male">Laki-laki</option>
                                <option value="female">Perempuan</option>
                            </select>
                        </div>

                        <!-- Graduation Year -->
                        <div class="col-md-6 mb-3">
                            <label for="graduationyear" class="form-label">Tahun Lulus</label>
                            <input type="number" class="form-control" id="graduationyear" name="graduationyear">
                        </div>

                        <!-- Asal Sekolah -->
                        <div class="col-md-6 mb-3">
                            <label for="asalsekolah" class="form-label">Asal Sekolah</label>
                            <input type="text" class="form-control" id="asalsekolah" name="asalsekolah">
                        </div>

                        <!-- idmajordata -->
                        <div class="col-md-6 mb-3">
                            <label for="idmajordata" class="form-label">ID Jurusan</label>
                            <select class="form-select" name="idmajordata" id="idmajordata" required>
                                <option value="">Pilih Jurusan</option>
                                {% for item in major_choices %}
                                    <option value="{{ item.idmajordata }}">{{ item }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <!-- idconcentrationdata -->
                        <div class="col-md-6 mb-3">
                            <label for="idconcentrationdata" class="form-label">Konsentrasi</label>
                            <select class="form-select" name="idconcentrationdata" id="idconcentrationdata">
                                <option value="">Pilih Konsentrasi</option>
                                {% for item in concentration_choices %}
                                    <option value="{{ item.idconcentrationdata }}">{{ item }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <!-- Nationality -->
                        <div class="col-md-6 mb-3">
                            <label for="nationality" class="form-label">Kebangsaan</label>
                            <input type="text" class="form-control" id="nationality" name="nationality">
                        </div>

                        <!-- Religion -->
                        <div class="col-md-6 mb-3">
                            <label for="iddatareligion" class="form-label">Agama</label>
                            <select class="form-control" id="iddatareligion" name="iddatareligion">
                                <option value="">Pilih</option>
                                <option value="1">Islam</option>
                                <option value="2">Kristen</option>
                                <option value="3">Katolik</option>
                                <option value="4">Hindu</option>
                                <option value="5">Budha</option>
                                <option value="6">Konghucu</option>
                            </select>
                        </div>

                        <!-- ispaid -->
                        <div class="col-md-6 mb-3">
                            <label class="form-label d-block">Sudah Bayar?</label>
                            <input type="checkbox" id="ispaid" name="ispaid" value="1"> Ya
                        </div>

                        <!-- isenrolled -->
                        <div class="col-md-6 mb-3">
                            <label class="form-label d-block">Sudah Enroll?</label>
                            <input type="checkbox" id="isenrolled" name="isenrolled" value="1"> Ya
                        </div>

                        <!-- groupreg -->
                        <div class="col-md-6 mb-3">
                            <label for="groupreg" class="form-label">Groupreg</label>
                            <select class="form-select" name="groupreg" id="groupreg" required>
                                <option value="">Pilih Groupreg</option>
                                {% for item in groupreg_choices %}
                                    <option value="{{ item.iddatagroupreg }}">{{ item }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <!-- regtype -->
                        <div class="col-md-6 mb-3">
                            <label for="regtype" class="form-label">Reg Type</label>
                            <select class="form-select" name="regtype" id="regtype" required>
                                <option value="">Pilih Regtype</option>
                                {% for item in tipe_registrasi_choices %}
                                    <option value="{{item.iddataregtype}}">{{ item }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <!-- iddataregkhusustype -->
                        <div class="col-md-6 mb-3">
                            <label for="iddataregkhusustype" class="form-label">Registrasi Khusus</label>
                            <select class="form-select" name="iddataregkhusustype" id="iddataregkhusustype">
                                <option value="">Pilih Registrasi Khusus</option>
                                {% for item in registrasi_khusus_choices %}
                                    <option value="{{ item.iddatakhusustype }}">{{ item }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <!-- idschooltypedata -->
                        <div class="col-md-6 mb-3">
                            <label for="idschooltypedata" class="form-label">Tipe Sekolah</label>
                            <select class="form-select" name="idschooltypedata" id="idschooltypedata">
                                <option value="">Pilih Tipe Sekolah</option>
                                {% for item in jenis_sekolah_choices %}
                                    <option value="{{ item.idschooltypedata }}">{{ item }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <!-- idschooljurusandata -->
                        <div class="col-md-6 mb-3">
                            <label for="idschooljurusandata" class="form-label">Jurusan Sekolah</label>
                            <select class="form-select" name="idschooljurusandata" id="idschooljurusandata">
                                <option value="">Pilih Jurusan Sekolah</option>
                                {% for item in jurusan_sekolah_choices %}
                                    <option value="{{ item.idschooljurusandata }}">{{ item }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <!-- iddataclasstype -->
                        <div class="col-md-6 mb-3">
                            <label for="iddataclasstype" class="form-label">Tipe Kelas</label>
                            <select class="form-select" name="iddataclasstype" id="iddataclasstype">
                                <option value="">Pilih Tipe Kelas</option>
                                {% for item in tipe_kelas_choices %}
                                    <option value="{{ item.iddataclasstype }}">{{ item }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <!-- iddataprovinces -->
                        <div class="col-md-6 mb-3">
                            <label for="iddataprovinces" class="form-label">Provinsi</label>
                            <select class="form-select" name="iddataprovinces" id="iddataprovinces">
                                <option value="">Pilih Provinsi</option>
                                {% for item in province_choices %}
                                    <option value="{{ item.id }}">{{ item }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <!-- iddataregencies -->
                        <div class="col-md-6 mb-3">
                            <label for="iddataregencies" class="form-label">Kabupaten/Kota</label>
                            <select class="form-select" name="iddataregencies" id="iddataregencies">
                                <option value="">Pilih Kabupaten</option>
                                {% for item in regency_choices %}
                                    <option value="{{ item.id }}">{{ item }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <!-- idcountrydata -->
                        <div class="col-md-6 mb-3">
                            <label for="idcountrydata" class="form-label">Negara</label>
                            <select class="form-select" name="idcountrydata" id="idcountrydata">
                                <option value="">Pilih Negara</option>
                                {% for item in country_choices %}
                                    <option value="{{ item.idcountrydata }}">{{ item }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <!-- Description -->
                        <div class="col-12 mb-3">
                            <label for="description" class="form-label">Deskripsi Data</label>
                            <input type="text" class="form-control" id="description" name="description" placeholder="Nama/Deskripsi Dataset">
                        </div>
                    </div>

    <div class="mt-3 text-end">
        <button type="submit" class="btn btn-success">Prediksi</button>
    </div>
</form>


            </div>
        </div>

        <!-- Upload Tab -->
        <div class="tab-pane fade" id="upload" role="tabpanel" aria-labelledby="upload-tab">
            <div class="card p-4">
                <h5 class="fw-bold mb-3">Upload Dataset Baru</h5>
                <hr>

                <!-- FORM YANG BENAR -->
                <form method="POST" enctype="multipart/form-data" action="{% url 'testing:upload_csv' %}" onsubmit="return validateFile()">

                    {% csrf_token %}

                    <!-- Nama/Deskripsi Data -->
                    <div class="mb-3">
                        <label for="description" class="form-label">Nama/Deskripsi Data</label>
                        <input type="text" class="form-control" id="description" name="description" placeholder="Masukkan deskripsi dataset" required>
                    </div>

                    <!-- Input File CSV -->
                    <div class="mb-3">
                        <label for="datasetFile" class="form-label">Pilih File Dataset</label>
                        <input type="file" class="form-control" id="datasetFile" name="datasetFile" accept=".csv" required>
                        <div id="fileError" class="text-danger mt-1 d-none">Hanya file .csv yang diperbolehkan!</div>
                    </div>

                    <!-- Tombol Upload -->
                    <button type="submit" class="btn btn-primary px-4">Upload</button>
                </form>    


            </div>
        </div>

        <!-- Menampilkan tabel jika ada hasil -->
        {% if pred_pendaftar %}
            <div id="predictionResult">
            <hr>
            <h5 class="mt-4">{{ description }}</h5>
            <ul class="list-group mt-3">
                
                <li class="list-group-item d-flex justify-content-between">
                    <strong>Prediksi Pendaftar</strong>
                    <span>{{ pred_pendaftar }}</span>
                </li>
                <li class="list-group-item d-flex justify-content-between">
                    <strong>Prediksi Bayar</strong>
                    <span>{{ pred_bayar }}</span>
                </li>
                <li class="list-group-item d-flex justify-content-between">
                    <strong>Prediksi Enroll</strong>
                    <span>{{ pred_enroll }}</span>
                </li>
                <div class="mt-3 text-end">
                    <button type="button" class="btn btn-danger" onclick="resetPrediction()">Reset</button>
                </div>
            </ul>
            </div>
        {% endif %}

    </div>
</div>

<!-- Script untuk Validasi File -->
<script>

    function resetPrediction() {
        const result = document.getElementById('predictionResult');
        if (result) {
            result.remove();  // hapus dari DOM
        }
    }

    function validateFile() {
        const fileInput = document.getElementById('datasetFile');
        const errorDiv = document.getElementById('fileError');
        const filePath = fileInput.value;

        if (!filePath.endsWith('.csv')) {
            errorDiv.classList.remove('d-none');
            return false;
        } else {
            errorDiv.classList.add('d-none');
            return true;
        }
    }
</script>
{% endblock %}
